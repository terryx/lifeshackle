<div class="content">
	<div class="page-header">
			<button class="btn info" onclick="clearForm()">New</button><br />
	</div>
	<div class="row">
	<div id="main-content" class="span11">
		<form id="article-form" class="form-stacked">
			<fieldset>
				<input type="hidden" id="article_id" name="article_id" />
				<div class="clearfix">
					<label for="title">Title</label>
					<div class="input">
						<input type="text" id="title" name="title" class="span8 validate[required]" />
					</div>
				</div>
				<div class="clearfix">
					<label for="txtcontent">Content</label>
					<div class="input">
						<textarea id="txtcontent" name="txtcontent" cols="60" rows="10"></textarea>
					</div>
				</div>
				<div class="clearfix">
					<label for="tag">Tag</label>
					<div class="input">
						<input type="text" id="tag" name="tag" class="span8"/>
					</div>
				</div>
				<div class="actions">
					<button type="submit" class="btn primary">Post</button>
					<button class="btn" type="reset">Cancel</button>
				</div>
			</fieldset>
		</form>
	</div>

	<div id="side-content" class="span5">
		<div id="pagination">

		</div>
		<div id="search-container">
			<form id="search-form">
				<input type="text" id="search" name="search" placeholder="Search" onkeyup="Search.filter();" class="span5" />
				<button type="submit" id="search-button" name="search-button"></button>
			</form>
		</div>
		<div id="search-result"></div>
	</div>
	</div>
</div>
<!-- include '/template/footer' -->
<script type="text/javascript" src="{{baseurl}}global/plugin/tiny_mce/jquery.tinymce.js"></script>
<script type="text/javascript">
	$('#txtcontent').tinymce({
		script_url : '{{baseurl}}global/plugin/tiny_mce/tiny_mce_gzip.php',

		theme : "advanced",
		plugins : "advimage,advlink,emotions,inlinepopups,preview,media,print,contextmenu,paste,fullscreen,noneditable,nonbreaking",
		dialog_type : "modal",
		content_css : "{{baseurl}}global/css/editor.css",
		// Theme options
		theme_advanced_buttons1 : "bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
		theme_advanced_buttons2 : "image,media,emotions,|,bullist,numlist,|,blockquote,|,undo,redo,|,anchor,cleanup,code,|,forecolor,backcolor,|,hr,removeformat,|,charmap,|,print,|,fullscreen,|,preview",
		theme_advanced_buttons3 : '',
		theme_advanced_toolbar_location : "top",
		theme_advanced_toolbar_align : "left",
		theme_advanced_statusbar_location : "bottom",
		theme_advanced_resizing : true

	});
</script>

<script type="text/javascript">
	var cachePage = 1;
//	function ajaxCallback(status, form, json){
//		$('body').css('cursor', 'default');
//		
//		if(status === true) {
//			switch(json[0]){
//				case 'updated':
//					displayMessage('info', json[1] + ' has been updated');
//					break;
//				case 'created':
//					displayMessage('success', json[2] + ' has been created');
//					refreshForm(json[1]);
//					break;
//				default:
//					displayMessage('error', json[1]);
//			}
//			Search.onload('{{baseurl}}article/admin-get-pagination/'+cachePage, '#article-form');
//		}
//	}

	function deleteArticle(id){
		$.delete_('{{baseurl}}article/delete_article/'+id, function(data){
			if(data){
				$('#newForm').click();
				Search.onload('{{baseurl}}article/get_article_list', '#article-form');

			}
			else {
				ajaxFail('Article could not be deleted');
			}
		});
	}
	
	function clearForm(){
		$('#article-form')[0].reset();
		$('#article_id').val('');
		var str = '<button type="submit" class="btn primary">Post</button>&nbsp;';
		str += '<button type="reset" class="btn">Cancel</button>';
		Common.clearDiv('.actions');
		$('.actions').append(str);
		
	}
	
	function refreshForm(id){
		$.get('{{baseurl}}article/get_one_article/'+id, function(data){
			if(data){
				$('#article_id').val(data.article_id);
				$('#title').val(data.title);
				$('#txtcontent').val(data.body);
				$('#tag').val(data.tag);

				var str = '<button type="submit" class="btn primary">Post</button>&nbsp;';
				str += '<button class="btn" type="reset">Cancel</button>&nbsp;';
				str += '<button class="btn danger" onclick="onclick="deleteArticle('+ data.article_id +')">Delete</button>';
				Common.clearDiv('.actions');
				$('.actions').append(str);
				
			}
		});
	}
	
	function countPage(){
		$.get('{{baseurl}}article/admin-count-page', function(data){
			if(data){
				paginate(data);
				Search.onload('{{baseurl}}article/admin-get-pagination/1', '#article-form');
			} else {
				return false;
			}
		});
	}

	function paginate(count){
		$("#pagination").paginate({
			count 		: count,
			start 		: 1,
			//      display     : 3,
			border					: true,
			border_color			: '#fff',
			text_color  			: '#fff',
			background_color    	: 'black',
			border_hover_color		: '#ccc',
			text_hover_color  		: '#000',
			background_hover_color	: '#fff',
			images					: false,
			mouse					: 'press',
			onChange     			: function(page){
				cachePage = page;
				Search.onload('{{baseurl}}article/admin-get-pagination/'+page);
			}
		});
	}
	
	function navModal(){
		$('#nav-modal').modal({
			backdrop : true,
			keyboard : true,
			show 	 : true
		});
	}

	$(function(){

		countPage();
		navModal();
		
		$('#article-form').bind('submit', function(e){
			e.preventDefault();
			
			$.ajax({
				type : 'POST',
				url : '{{baseurl}}article/save-article',
				data : $('#article-form').serialize(),
				dataType: 'json',
				statusCode : {
					200 : function(data){
						
					},
					201 : function(data){
						
					},
					400 : function(data){
						
					},
					404 : function(data){
						
					}
				}
			})
		});

	}); //end document ready


</script>